transports/smart_protocol.c